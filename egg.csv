|Yetus| |YETUS-495| |Jenkins report shouldn't include -1 for compile report without the patch| |15/Mar/17| |15/Mar/17| |In YARN-6336, the patch fixed a YARN UI build failure. However, the Jenkins report have 1 build failure and 1 build success which is confusing on which one is w/o the patch. Also, the final result still count -1 for build failure without the patch which is not right. We should fix this issue which is very confusing.| |Critical| |2| |It looks like others in that JIRA understood that Yetus reports before and after. If one reads the text, they can see "in the (branch)" vs. "in the patch". This signifies the before and after states. FWIW, the overall -1 came because there were no tests that Yetus could see.FWIW, the overall -1 came because there were no tests that Yetus could see. Oh. I could miss that.|
|Yetus| |YETUS-489| |checkstyle.sh does not support checkstyle 6.14 or upper| |27/Feb/17| |02/Mar/17| |The output format has changed in checkstyle 6.14 by https://github.com/checkstyle/checkstyle/issues/2666.
Before:

/Users/ajisaka/git/hadoop/hadoop-common-project/hadoop-annotations/src/main/java/org/apache/hadoop/classification/InterfaceAudience.java:0: error: Missing package-info.java file.


After:

[ERROR] /Users/ajisaka/git/hadoop/hadoop-common-project/hadoop-annotations/src/main/java/org/apache/hadoop/classification/InterfaceAudience.java:0: Missing package-info.java file. [JavadocPackage]


checkstyle.sh does not support the latter.| |Major| |16| |01 patch: Removed [ERROR] in the beginning of line.A patch to the testing environment has been detected. Re-executing against the patched versions to perform further tests. The console is at https://builds.apache.org/job/PreCommit-YETUS-Build/536/console in case of problems.-1 overall Vote Subsystem Runtime Comment 0 reexec 0m 16s Docker mode activated. +1 @author 0m 0s The patch does not contain any @author tags. -1 shellcheck 0m 1s The patch generated 1 new + 1 unchanged - 0 fixed = 2 total (was 1) +1 shelldocs 0m 1s There were no new shelldocs issues. +1 whitespace 0m 0s The patch has no whitespace issues. +1 asflicense 0m 0s The patch does not generate ASF License warnings. 0m 25s Subsystem Report/Notes Docker Client=1.12.3 Server=1.12.3 Image:yetus/yetus:e4e4903 JIRA Issue YETUS-489 JIRA Patch URL https://issues.apache.org/jira/secure/attachment/12854866/YETUS-489.01.patch Optional Tests shellcheck shelldocs uname Linux 509dc6cfd7c0 4.4.0-43-generic #63-Ubuntu SMP Wed Oct 12 13:48:03 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux Build tool nobuild git revision master / 9cbfe9c shellcheck v0.4.5 shellcheck https://builds.apache.org/job/PreCommit-YETUS-Build/536/artifact/patchprocess/diff-patch-shellcheck.txt modules C: . U: . Console output https://builds.apache.org/job/PreCommit-YETUS-Build/536/console Powered by Apache Yetus 0.5.0-SNAPSHOT http://yetus.apache.org This message was automatically generated.02 patch: Fixed shellcheck error.A patch to the testing environment has been detected. Re-executing against the patched versions to perform further tests. The console is at https://builds.apache.org/job/PreCommit-YETUS-Build/537/console in case of problems.+1 overall Vote Subsystem Runtime Comment 0 reexec 0m 20s Docker mode activated. +1 @author 0m 0s The patch does not contain any @author tags. +1 shellcheck 0m 1s There were no new shellcheck issues. +1 shelldocs 0m 0s There were no new shelldocs issues. +1 whitespace 0m 0s The patch has no whitespace issues. +1 asflicense 0m 1s The patch does not generate ASF License warnings. 0m 28s Subsystem Report/Notes Docker Client=1.12.3 Server=1.12.3 Image:yetus/yetus:e4e4903 JIRA Issue YETUS-489 JIRA Patch URL https://issues.apache.org/jira/secure/attachment/12854868/YETUS-489.02.patch Optional Tests shellcheck shelldocs uname Linux 993e56553874 4.4.0-43-generic #63-Ubuntu SMP Wed Oct 12 13:48:03 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux Build tool nobuild git revision master / 9cbfe9c shellcheck v0.4.5 modules C: . U: . Console output https://builds.apache.org/job/PreCommit-YETUS-Build/537/console Powered by Apache Yetus 0.5.0-SNAPSHOT http://yetus.apache.org This message was automatically generated.Tested on Hadoop trunk and worked fine. Just one question, should we handle other severities such as [WARN]? Some project other than Hadoop may change severity for messages.Thanks Kengo Seki for the review! Just one question, should we handle other severities such as [WARN]? Some project other than Hadoop may change severity for messages. Yes. I'm thinking we should handle [WARN] as well because a project can change the severity easily. An example of the setting is https://github.com/checkstyle/checkstyle/blob/checkstyle-7.6/src/test/resources/com/puppycrawl/tools/checkstyle/config-classname.xml#L10 According to https://github.com/checkstyle/checkstyle/blob/checkstyle-7.6/src/main/java/com/puppycrawl/tools/checkstyle/api/SeverityLevel.java, there are 4 severities in checkstyle: IGNORE INFO WARNING (will become WARN when printed) ERROR and I'll update the patch to handle WARN and ERROR.03 patch handle [WARN] as well.A patch to the testing environment has been detected. Re-executing against the patched versions to perform further tests. The console is at https://builds.apache.org/job/PreCommit-YETUS-Build/538/console in case of problems.-1 overall Vote Subsystem Runtime Comment 0 reexec 0m 0s Docker mode activated. -1 docker 5m 4s Docker failed to build yetus/yetus:e4e4903. Subsystem Report/Notes JIRA Issue YETUS-489 JIRA Patch URL https://issues.apache.org/jira/secure/attachment/12855182/YETUS-489.03.patch Console output https://builds.apache.org/job/PreCommit-YETUS-Build/538/console Powered by Apache Yetus 0.5.0-SNAPSHOT http://yetus.apache.org This message was automatically generated.A patch to the testing environment has been detected. Re-executing against the patched versions to perform further tests. The console is at https://builds.apache.org/job/PreCommit-YETUS-Build/539/console in case of problems.-1 overall Vote Subsystem Runtime Comment 0 reexec 0m 0s Docker mode activated. -1 docker 3m 51s Docker failed to build yetus/yetus:e4e4903. Subsystem Report/Notes JIRA Issue YETUS-489 JIRA Patch URL https://issues.apache.org/jira/secure/attachment/12855182/YETUS-489.03.patch Console output https://builds.apache.org/job/PreCommit-YETUS-Build/539/console Powered by Apache Yetus 0.5.0-SNAPSHOT http://yetus.apache.org This message was automatically generated.Precommit failure seems a network issue. I locally tested with test-patch and no problem found. And I confirmed 03 works well with [WARN] severity. +1 committing shortly.Committed. Thanks Akira Ajisaka!Thank you, Kengo Seki!|
|Yetus| |YETUS-484| |Fixing bug when checkstyle runs on multiple modules| |30/Jan/17| |02/Feb/17| |When trying to run checkstyle plugin with a patch which changes 2 modules the checkstyle changes directory to the first modules directory twice, so no change file is generated for the second directory.
See:


============================================================================
============================================================================
                               checkstyle: 
============================================================================
============================================================================


[Mon Jan 30 16:19:57 CET 2017 DEBUG]: Start clock
[Mon Jan 30 16:19:57 CET 2017 DEBUG]: Personality: branch checkstyle
[Mon Jan 30 16:19:57 CET 2017 DEBUG]: Personality: clear queue
[Mon Jan 30 16:19:57 CET 2017 DEBUG]: Personality: enqueue ql -DskipTests -Pitests
[Mon Jan 30 16:19:57 CET 2017 DEBUG]: Personality: enqueue serde -DskipTests -Pitests
[Mon Jan 30 16:19:57 CET 2017 DEBUG]: Start clock
cd /Users/petervary/dev/upstream/hive/ql
mvn checkstyle:checkstyle -Dcheckstyle.consoleOutput=true -DskipTests -Pitests -Ptest-patch > /private/tmp/yetus-16782.23776/maven-branch-checkstyle-ql.txt 2>&1
[Mon Jan 30 16:20:40 CET 2017 DEBUG]: Stop clock
[Mon Jan 30 16:20:40 CET 2017 DEBUG]: Start clock
cd /Users/petervary/dev/upstream/hive/ql
mvn checkstyle:checkstyle -Dcheckstyle.consoleOutput=true -DskipTests -Pitests -Ptest-patch > /private/tmp/yetus-16782.23776/maven-branch-checkstyle-serde.txt 2>&1


My guess is there is a missing parameter in checkstyle.sh when calling {{   buildtool_cwd}} without parameters.
Adding the parameter resolves the directory change problem, and yetus generates the error report for both modules.| |Major| |7| |Adding the parameterA patch to the testing environment has been detected. Re-executing against the patched versions to perform further tests. The console is at https://builds.apache.org/job/PreCommit-YETUS-Build/521/console in case of problems.+1 overall Vote Subsystem Runtime Comment 0 reexec 19m 27s Docker mode activated. +1 @author 0m 0s The patch does not contain any @author tags. +1 shellcheck 0m 1s There were no new shellcheck issues. +1 shelldocs 0m 0s There were no new shelldocs issues. +1 whitespace 0m 0s The patch has no whitespace issues. +1 asflicense 0m 0s The patch does not generate ASF License warnings. 19m 31s Subsystem Report/Notes Docker Client=1.11.2 Server=1.11.2 Image:yetus/yetus:e4e4903 JIRA Issue YETUS-484 JIRA Patch URL https://issues.apache.org/jira/secure/attachment/12849981/YETUS-484.00.patch Optional Tests shellcheck shelldocs uname Linux 79fc8555edd9 3.13.0-106-generic #153-Ubuntu SMP Tue Dec 6 15:44:32 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux Build tool nobuild git revision master / 0000965 shellcheck v0.4.5 modules C: . U: . Console output https://builds.apache.org/job/PreCommit-YETUS-Build/521/console Powered by Apache Yetus 0.5.0-SNAPSHOT http://yetus.apache.org This message was automatically generated.Casey Brotherton, Sean Busbey or Suraj Acharya could you pleas take a look at this patch? Thanks, PeterMy guess is there is a missing parameter in checkstyle.sh when calling {{ buildtool_cwd}} without parameters. Yup. My bug. +1Great catch, Peter. Committed to master. Thanks!Thanks Allen Wittenauer!|
|Yetus| |YETUS-476| |Replace docker's time handler with awk| |14/Dec/16| |06/Mar/17| |awk '{srand(); t=srand(); print t;}' 


will generate the current epoch in a portable way!
h/t to Cody Mello| |Major| |9| |Replaced date with awk to get current epoch time.A patch to the testing environment has been detected. Re-executing against the patched versions to perform further tests. The console is at https://builds.apache.org/job/PreCommit-YETUS-Build/523/console in case of problems.+1 overall Vote Subsystem Runtime Comment 0 reexec 14m 25s Docker mode activated. +1 @author 0m 0s The patch does not contain any @author tags. +1 shellcheck 0m 0s There were no new shellcheck issues. +1 shelldocs 0m 0s There were no new shelldocs issues. +1 whitespace 0m 0s The patch has no whitespace issues. +1 asflicense 0m 0s The patch does not generate ASF License warnings. 14m 32s Subsystem Report/Notes Docker Client=1.11.2 Server=1.11.2 Image:yetus/yetus:e4e4903 JIRA Issue YETUS-476 JIRA Patch URL https://issues.apache.org/jira/secure/attachment/12851151/YETUS-476.00.patch Optional Tests shellcheck shelldocs uname Linux feae9a8421bd 3.13.0-107-generic #154-Ubuntu SMP Tue Dec 20 09:57:27 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux Build tool nobuild git revision master / f70fceb shellcheck v0.4.5 modules C: . U: . Console output https://builds.apache.org/job/PreCommit-YETUS-Build/523/console Powered by Apache Yetus 0.5.0-SNAPSHOT http://yetus.apache.org This message was automatically generated.The change looks good to me. There is also an instance of the same date call in test-patch.sh. Should that be updated too? Allen Wittenauer, you filed this ticket with a title specifically talking about the Docker code. Did you think the scope of this change should be limited to that file?Thanks Chris Nauroth for the review. Changed test-patch.sh as well. I had to initialize GLOBALTIMER after common_defaults because $AWK is initialized there.A patch to the testing environment has been detected. Re-executing against the patched versions to perform further tests. The console is at https://builds.apache.org/job/PreCommit-YETUS-Build/525/console in case of problems.+1 overall Vote Subsystem Runtime Comment 0 reexec 0m 19s Docker mode activated. +1 @author 0m 0s The patch does not contain any @author tags. +1 shellcheck 0m 6s There were no new shellcheck issues. +1 shelldocs 0m 0s There were no new shelldocs issues. +1 whitespace 0m 0s The patch has no whitespace issues. +1 asflicense 0m 0s The patch does not generate ASF License warnings. 0m 33s Subsystem Report/Notes Docker Client=1.11.2 Server=1.11.2 Image:yetus/yetus:e4e4903 JIRA Issue YETUS-476 JIRA Patch URL https://issues.apache.org/jira/secure/attachment/12851290/YETUS-476.01.patch Optional Tests shellcheck shelldocs uname Linux 455fb265600d 3.13.0-103-generic #150-Ubuntu SMP Thu Nov 24 10:34:17 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux Build tool nobuild git revision master / f70fceb shellcheck v0.4.5 modules C: . U: . Console output https://builds.apache.org/job/PreCommit-YETUS-Build/525/console Powered by Apache Yetus 0.5.0-SNAPSHOT http://yetus.apache.org This message was automatically generated.+1 looks good. whoever pushes the change should update the subject to note that we're doing it everywhere instead of just the docker stuff.+1 for patch revision 01. I have committed the patch. Thanks, everyone!|
|Yetus| |YETUS-472| |Exclude src/test/java from findbugs source folders by default| |09/Dec/16| |19/Dec/16| |Now I'm seeing the following failure in hadoop-yarn-server-tests module. https://builds.apache.org/job/hadoop-qbt-trunk-java8-linux-x86/249/console
branch/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-tests no findbugs output file (hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-tests/target/findbugsXml.xml)
This issue occurs because findbugs plugin runs only on src/main/java directory by default and there is no src/main/java directory in hadoop-yarn-server-tests module (i.e. the module has test code only). That way the plugin does not output findbugsXml.xml and findbugs_runner set -1 to the module. To fix this issue, I'd like to make the findbugs source folders to src/main/java only by default.| |Major| |8| |Attached a patch to skip running findbugs on the modules which have only test code.A patch to the testing environment has been detected. Re-executing against the patched versions to perform further tests. The console is at https://builds.apache.org/job/PreCommit-YETUS-Build/511/console in case of problems.+1 overall Vote Subsystem Runtime Comment 0 reexec 0m 22s Docker mode activated. +1 @author 0m 0s The patch does not contain any @author tags. +1 shellcheck 0m 1s There were no new shellcheck issues. +1 shelldocs 0m 1s There were no new shelldocs issues. +1 whitespace 0m 0s The patch has no whitespace issues. +1 asflicense 0m 0s The patch does not generate ASF License warnings. 0m 29s Subsystem Report/Notes Docker Client=1.11.2 Server=1.11.2 Image:yetus/yetus:e4e4903 JIRA Issue YETUS-472 JIRA Patch URL https://issues.apache.org/jira/secure/attachment/12842471/YETUS-472.01.patch Optional Tests shellcheck shelldocs uname Linux 3fff43e0d539 3.13.0-95-generic #142-Ubuntu SMP Fri Aug 12 17:00:09 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux Build tool nobuild git revision master / 3acbea7 shellcheck v0.4.5 modules C: . U: . Console output https://builds.apache.org/job/PreCommit-YETUS-Build/511/console Powered by Apache Yetus 0.5.0-SNAPSHOT http://yetus.apache.org This message was automatically generated.+1 will apply later this evening barring someone else wanting to review.Also +1. Will commit shortly.Committed, thanks Akira Ajisaka.Thanks you, Sean Busbey and Kengo Seki!Cherry-picked to YETUS-468 branch.|
|Yetus| |YETUS-470| |user_plugin directory is not copied over properly.| |19/Nov/16| |09/Dec/16| |When a new build plugin is written and placed in a non default location (yetus/precommit/test-patch.d/build_plugin.sh) and run with docker, it errors out since those locations are not copied over properly.| |Major| |6| |A patch to the testing environment has been detected. Re-executing against the patched versions to perform further tests. The console is at https://builds.apache.org/job/PreCommit-YETUS-Build/506/console in case of problems.+1 overall Vote Subsystem Runtime Comment 0 reexec 7m 45s Docker mode activated. +1 @author 0m 0s The patch does not contain any @author tags. +1 shellcheck 0m 5s There were no new shellcheck issues. +1 shelldocs 0m 0s There were no new shelldocs issues. +1 whitespace 0m 0s The patch has no whitespace issues. +1 asflicense 0m 0s The patch does not generate ASF License warnings. 7m 52s Subsystem Report/Notes Docker Client=1.11.2 Server=1.11.2 Image:yetus/yetus:e4e4903 JIRA Issue YETUS-470 JIRA Patch URL https://issues.apache.org/jira/secure/attachment/12839706/0001-YETUS-470-FIX-user_plugin-directory-is-not-copied-ov.patch Optional Tests shellcheck shelldocs uname Linux 78107da15450 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux Build tool nobuild git revision master / 9740b64 shellcheck v0.4.5 modules C: . U: . Console output https://builds.apache.org/job/PreCommit-YETUS-Build/506/console Powered by Apache Yetus 0.4.0-SNAPSHOT http://yetus.apache.org This message was automatically generated.Suraj Acharya sorry for the late response and thank you for the contribution. I'll try your patch today.Confirmed that it worked well on Ubuntu and macOS. +1 committing shortly. I found that -r option for cp is not POSIX-compliant, but this option is used in other places as well. So I'll file it as another JIRA.Committed. Thanks!I have cherry-picked the commit corresponding to this JIRA to YETUS-468 branch(for 0.4.0 release)|
|Yetus| |YETUS-469| |running docker as root fails.| |19/Nov/16| |05/Dec/16| |when test-patch is run as root, and it errors out since the user root and group root existed.| |Major| |5| |A patch to the testing environment has been detected. Re-executing against the patched versions to perform further tests. The console is at https://builds.apache.org/job/PreCommit-YETUS-Build/505/console in case of problems.+1 overall Vote Subsystem Runtime Comment 0 reexec 15m 15s Docker mode activated. +1 @author 0m 0s The patch does not contain any @author tags. +1 shellcheck 0m 0s There were no new shellcheck issues. +1 shelldocs 0m 0s There were no new shelldocs issues. +1 whitespace 0m 0s The patch has no whitespace issues. +1 asflicense 0m 0s The patch does not generate ASF License warnings. 15m 21s Subsystem Report/Notes Docker Client=1.11.2 Server=1.11.2 Image:yetus/yetus:e4e4903 JIRA Issue YETUS-469 JIRA Patch URL https://issues.apache.org/jira/secure/attachment/12839705/0001-YETUS-469-FIX-running-docker-as-root-fails.patch Optional Tests shellcheck shelldocs uname Linux 405dd05b5baf 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux Build tool nobuild git revision master / 9740b64 shellcheck v0.4.5 modules C: . U: . Console output https://builds.apache.org/job/PreCommit-YETUS-Build/505/console Powered by Apache Yetus 0.4.0-SNAPSHOT http://yetus.apache.org This message was automatically generated.Ajay Yadava let me know if you'd prefer I pull this back to the YETUS-468 branch or if you'd like to (or if you'd rather it be skipped and I'll update the fix version).I can cherry-pick it to YETUS-468 branch (along with YETUS-470).I have cherry-picked the commit corresponding to this JIRA to YETUS-468 branch(for 0.4.0 release)|
|Yetus| |YETUS-467| |Update hbase personality after YETUS-322 "flip verify_ result codes"| |28/Oct/16| |09/Dec/16| |HBase personality makes use of verify_needed_test Needs to use the new idiom around verify_needed_test result post YETUS-322.| |Major| |3| |A patch to the testing environment has been detected. Re-executing against the patched versions to perform further tests. The console is at https://builds.apache.org/job/PreCommit-YETUS-Build/500/console in case of problems.+1 overall Vote Subsystem Runtime Comment 0 reexec 14m 29s Docker mode activated. 0 patch 0m 2s The patch file was not named according to yetus's naming conventions. Please see https://yetus.apache.org/documentation/in-progress/precommit-patchnames for instructions. +1 @author 0m 0s The patch does not contain any @author tags. +1 shellcheck 0m 0s The patch generated 0 new + 0 unchanged - 2 fixed = 0 total (was 2) +1 shelldocs 0m 0s There were no new shelldocs issues. +1 whitespace 0m 0s The patch has no whitespace issues. +1 asflicense 0m 0s The patch does not generate ASF License warnings. 14m 34s Subsystem Report/Notes Docker Client=1.11.2 Server=1.11.2 Image:yetus/yetus:e4e4903 JIRA Issue YETUS-467 JIRA Patch URL https://issues.apache.org/jira/secure/attachment/12835914/YETUS-467.txt Optional Tests shellcheck shelldocs uname Linux 21667ed77d96 3.13.0-93-generic #140-Ubuntu SMP Mon Jul 18 21:21:05 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux Build tool nobuild git revision master / 99540d4 shellcheck v0.4.5 modules C: . U: . Console output https://builds.apache.org/job/PreCommit-YETUS-Build/500/console Powered by Apache Yetus 0.4.0-SNAPSHOT http://yetus.apache.org This message was automatically generated.thanks for the fix!|
|Yetus| |YETUS-465| |findbugs should not -1 if base branch has warnings when the patch fixes them| |13/Oct/16| |14/Oct/16| |In HADOOP-13669, the base branch (trunk) has 2 findbugs warnings, and a patch fixes them. But pre-commit returns:

-1	findbugs	0m 26s	hadoop-common-project/hadoop-kms in trunk has 2 extant Findbugs warnings.


IMO this would be better if it says +1 and (had 2 warnings, fixed).| |Major| |2| |There's already a way to disable that. (don't use the --findbugs-strict-precheck flag) The Hadoop community has opted to keep it a failure to draw attention to the fact that the findbugs issues tagged needs to get fixed and not forgotten. Closing as won't fix.Thanks Allen Wittenauer for explaining this from both yetus and hadoop pov. Now I for sure can remember findbugs warnings are not to be forgiven.|
